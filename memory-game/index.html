<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html"; charset="UTF-8">
<title>Memory Game</title>
<style>
.card{
   border: 1px solid black;
   display: inline-block;
   overflow:hidden;
   text-align: center;
   font-size:80px;
   height: 100px;
   width: 100px;
   margin-left: 3px;
   background-color: blue;
   cursor:pointer;
   user-select: none;
   line-height: 100px;
   border-radius: 10px;
}
#note{
   display: inline;
   background-color: white;
}
#card_holder{
   white-space: nowrap;
   overflow-x: auto;
}
@keyframes alert{
	0%{opacity:0;}
	50%{opacity:1;}
}
@keyframes flip{
  from{transform: rotateY(180deg);}
  to{transform: rotateY(0deg);}
}
@keyframes flip_back{
   from{transform: rotateY(0deg);}
   to{transform: rotateY(180deg);}
}
.levels span{
   color:gray;
   cursor:pointer;
   user-select: none;
}
.levels span:hover{
   text-decoration: underline;
}
.app-root{
   display: flex;
   background-color: blue;
   font-size: 23pt;
   color:#ffffff;
}
.app-root > #stars{
   margin-left: 1em;
   margin-right: 1em;
}
.levels{
   font-size: 20px;
}
.alert{
   background-color: rgba(0,0,0,0.7);
   height: 100%;
   width: 100%;
   position:absolute;
   z-index: 1;
   top:0;
   left:0;
   display: flex;
   align-items: center;
   justify-content: center;
}
.text-alert{
   min-width: 288px;
   min-height: 150px;
   max-width: 6in;
   border-radius: 3px;
   background-color: white;
   border: 2px solid rgb(201,200,206);
}
.title{
   height:30px;
   width:98%;
   background-color: rgb(201,200,206);
   font-size: 22pt;
   border-radius: 3px;
   margin-left: 3px;
   margin-top: 3px;
}
.text{
   hyphens: auto;
   min-width: 288px;
   min-height: 90px;
   max-width: 6in;
   background-color: white;
}
.buttons{
   min-height:30px;
   width:98%;
   background-color: rgb(201,200,206);
   font-size: 22pt;
   border-radius: 3px;
   margin-left: 3px;
   margin-top: 3px;
   display: flex;
   flex-wrap: wrap;
}
.button{
   margin: 10px
}
.more{
   height:30px;
   width:30px;
}
@keyframes slidein {
   from{height: 100%; width:0px;display:none;}
   to{height: 100%; width:25%;display:inline;visibility:visible;}
}
@keyframes slideout {
      from{height: 100%; width:25%;display:inline;}
      to{height: 100%; width:0px;display:none;visibility:hidden;}
}
.side{
   height:100%;
   width:0px;
   overflow: hidden;
   position:absolute;
   z-index: 1;
   background-color: white;
   visibility:hidden;
}
</style>
</head>
<body id="matcher" style="margin:0px;">
   <div class = "app-root">
   <div>Memory Game</div>
   <div id="stars">Star Rating: </div>
   <div id="moves">Moves: </div>
   </div>
   <div class = "side">
      <button class="close">x</button><br>
      <a download="memory_game.html" id="download">download memory_game</a>
   </div>
   <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.logolynx.com%2Fimages%2Flogolynx%2F0e%2F0e0133e58d41ff3ceb3eef095df532fd.png&f=1&nofb=1" class="more"><br>
   <em>thank you pexels for such nice photots and thank you whoever's photos these are </em>
   <br>
   <noscript> <p style="animation:alert 3s; opacity:1; height:200px; width:200px; background-color:rgba(34,206,206,0.5); border:1px solid black; text-align:center;" id="1">javascript is disabled please enable it and reload the page</p> </noscript>
   <p id="note" ></p>
   <br>
   <div class="levels">Levels: <span class="beg">beginer</span> <span class="inter">intermedite</span> <span class="expert">expert</span> <span class = "custom">custom</span><span id = "custom" style="display:none;"><input type="text" id="value" placeholder="enter the  (e.g. 6x4)">
   <button id="reset">reset</button></span></div> <button class = "nums">numbers</button> <button class = "img">images</button><br><br>
   <div id="card_holder">
   </div>
   <script>
   (function() {
      let animal_names = [
         'barn-owl-1.png', 'bear-1.png', 'beaver-1.png', 'buffalo-1.png', 'camel-1.png',
         'cheetah-1.png', 'chicken-1.png', 'dog-1.png', 'elephant-1.png', 'fox-1.png',
         'hippo-1.png', 'horse-1.png', 'kangaroo-3.png', 'koala-1.png', 'ladybug-1.png',
         'lion-1.png', 'ostrich-1.png', 'panda-bear-1.png', 'parrot-1.png', 'pig-1.png',
         'pigeon-1.png', 'rabbit-1.png', 'ram-1.png', 'rat-1.png', 'reindeer-1.png',
         'snail-1.png', 'tiger-1.png', 'turtle-1.png'
      ];
      //alert("⚠️ \n \n \n don't open the inspector,console,debugger,network,style editor,preformence,memory,storage,accesibility,whats new, or any other extention programs that you have , before the page has fully loaded");
      function Jalert(message,title,delay,buttons){
         message = message || "nothing to display";
         title = title || "Alert";
         delay = delay || false;
         buttons = buttons || false;
         console.log("custom alert")
         let alert = document.createElement("DIV");
         alert.className = "alert";
         document.body.appendChild(alert);
         let text_alert = document.createElement("DIV");
         text_alert.className = "text-alert";
         text = document.createElement("DIV");
         text.className = "text";
         text.lang = "en";
         let titlee = document.createElement("DIV");
         titlee.className = "title";
         titlee.innerHTML = title;
         text.innerHTML += message;
         text_alert.appendChild(titlee);
         text_alert.appendChild(text);
         var buttone = document.createElement("DIV");
         buttone.className = "buttons";
         let b = 0;
         for(b in buttons){
            let ub = document.createElement("BUTTON");
            ub.innerHTML = b;
            ub.addEventListener("click",buttons[b])
            ub.className = "button";
            buttone.appendChild(ub);
         }
         if(buttons == false){
            delete buttone;
         }
         else{
            text_alert.appendChild(buttone);
         }
         alert.appendChild(text_alert);
         this.alert = alert;
         if(delay){
            setTimeout(function () {
               alert.remove();
            }, delay);
         }
      }
      console.warn("⚠️ don't open the inspector,console,debugger,network,style editor,preformence,memory,storage,accesibility,whats new, or any other extention programs that you have , before the page has fully loaded");
      let blocks_per_height = ((window.innerHeight / 103) | 0) - 1;
      let blocks_per_width = (window.innerWidth / 103) | 0;
      document.getElementById("note").innerHTML += " your screen can fit about " + blocks_per_width + "x" + blocks_per_height + " ." ;
      let clicks = 0;
      let nums = [];
      let i;
      let mode = "nums";
      let memory_dictionary = [];
      let id_list = [];
      let counter = 0;
      let starr = "";
      let stars = document.getElementById('stars');
      let moves = document.getElementById('moves');
      let card_count;
      let levels = ["beg","expert","inter","custom"];
      let done = true;
      let level;
      moves.innerHTML += counter;
      stars.innerHTML += starr;
      let pics = [];
      let file = "";
      i = 0;
      for(i of animal_names){
         file = "../memory-game/images/" + i;
         pics.push(file);
      }
      i = 0;
      console.log(pics);
      document.querySelector("#download").href = window.location;
      document.getElementById("reset").addEventListener("click",
      function(){
         decode("reset");
      });
      document.querySelector(".close").addEventListener("click",function(){
         el = document.querySelector(".side");
         el.style.animation = "slideout 1s";
         el.style.animationFillMode = "forwards";
      })
      document.querySelector(".more").addEventListener("click",function(){
         el = document.querySelector(".side");
         el.style.animation = "slidein 1s";
         el.style.animationFillMode = "forwards";
      })
      document.querySelector("#value").addEventListener("keypress",function(){
         decode("create",event)
      })
      document.querySelector(".custom").addEventListener("click",function(){
         document.querySelector("#custom").style.display = "inline";
         nonselectall("custom");
         decode("reset");
         level = "custom";
      })
      document.querySelector(".expert").addEventListener("click",function(){
         document.querySelector("#custom").style.display = "none";
         nonselectall("expert");
         make_grid(6,4);
         level="expert";
      })
      document.querySelector(".img").addEventListener("click",function(){
         mode = "img";
         console.log("imgs",mode)
         document.querySelector("#value").placeholder = "max " + pics.length * 2  + " cards";
         document.querySelector("." + level).click();
         console.log();
         console.log();
         if(level == "custom"){
            decode("create");
         }
      })
      document.querySelector(".nums").addEventListener("click",function(){
         mode = "nums";
         console.log("nums",mode);
         document.querySelector("#value").placeholder = "enter the  (e.g. 6x4)";
         document.querySelector("." + level).click();
         if(level == "custom"){
            decode("create");
         }
      })
      document.querySelector(".inter").addEventListener("click",function(){
         document.querySelector("#custom").style.display = "none";
         decode("reset");
         nonselectall("inter");
         make_grid(4,4);
         level="inter";
      })
      document.querySelector(".beg").addEventListener("click",function(){
         document.querySelector("#custom").style.display = "none";
         decode("reset");
         nonselectall("beg");
         level = "beg";
         make_grid(3,2);
      })
      decode("reset");
      document.getElementById("card_holder").addEventListener("click",choose);
      document.querySelector(".inter").click()
      /*
      class InputError extends Error {
         constructor(message) {
            super(message);
            this.name = "InputError";
         }
      }
      */
      function nonselectall(except){// function to select everythung except the argument except
         let i;
         document.querySelector("." + except).style.color = "blue";
         for(i of levels){
            if(i == except){
               continue
            }
            document.querySelector("." + i).style.color = "gray";
         }
      }
      function range(f, t){// function to create numbers in a range
         let ar = [];
         for(let i = f; i <= t; ++i) ar.push(i);
         return ar;
      }
   /*
   function sleep(delay) {
         var start = new Date().getTime();
         while(new Date().getTime() < start + delay);
      }//*/
      function make_grid(width, height){// function to make the
         decode("reset");
         console.log("in make_grid");
         starr = "⭐⭐⭐" // the star rating is always set to 3 when a new gid is made
         stars.innerHTML = "Star Rating: " + starr;
         card_count = width * height;
         let h = 0;
         let w = 0;
         clicks = 0;
         nums = [];
         id_list = range(0, card_count-1);
         done = true;
         let memory_counter = 0;
         let id_counter = 0;
         memory_dictionary = [];
         if(mode == "nums"){
            console.log(mode);
            console.log("hello");
            console.log(`card_count : ${card_count}`)
            let memory_numbers = range(1, card_count/2);
            memory_numbers = memory_numbers.concat(memory_numbers);
            memory_numbers = shuffle(memory_numbers);
            memory_dictionary = memory_numbers.concat();
         }
         else {
            pics = shuffle(pics);
            let memory_imgs = pics.slice(0 , (card_count / 2));
            console.log(memory_imgs);
            memory_imgs = memory_imgs.concat(memory_imgs);
            memory_imgs = shuffle(memory_imgs);
            memory_dictionary = memory_imgs.concat()
            console.log(memory_imgs);
         }
         console.log("making ...");
         for(let h = 0; h < height; ++h ) {
           for(let w = 0; w < width; ++w) {
               let current_card = document.createElement("DIV");
               current_card.id = "card-" + id_list[id_counter];
               current_card.dataset.number = id_list[id_counter];
               current_card.className = "card";
               document.getElementById("card_holder").appendChild(current_card);
               memory_counter ++;
               id_counter++;
            }
            let br = document.createElement("BR");
            document.getElementById("card_holder").appendChild(br);
         }
         console.log(memory_dictionary);
      }
      function flip(id_to_flip){
         document.getElementById(id_to_flip).style.animation = "flip 0.5s";
         setTimeout(function(){
            if(mode == "nums"){
               document.getElementById(id_to_flip).innerHTML = memory_dictionary[document.getElementById(id_to_flip).dataset.number];
            }
            else{
               document.getElementById(id_to_flip).innerHTML = "<img src = " + memory_dictionary[document.getElementById(id_to_flip).dataset.number] + " height='100px' width='100px'>";
               console.log(memory_dictionary[id_to_flip]);
            }
            document.getElementById(id_to_flip).style.backgroundColor = "white";
         },150)
      }
      function flip_back(id_to_flip_back){
         document.getElementById(id_to_flip_back).style.animation = "flip_back 0.5s";
         setTimeout(function(){
            document.getElementById(id_to_flip_back).innerHTML = "";
            document.getElementById(id_to_flip_back).style.backgroundColor = "blue";
         },150)
      }
      function choose(event){
         let id = event.target.id;
         console.log(id);
         console.log(id_list);
         if(id_list.includes(parseInt(id.replace("card-",""))) && document.getElementById(id).style.backgroundColor != "green"){
            console.log("checking...");
            flip(id);
            console.log("done fliping");
            if(clicks != 2 && nums.includes(id) == false){
               console.log("skiped");
               counter++;
               moves.innerHTML = "Moves: " + counter;
               if(counter <= card_count + (card_count / 2) ){
                  starr = "⭐⭐⭐";
                  console.log(starr);
                  stars.innerHTML = "Star Rating: " + starr;
               }
               else if(counter >= card_count * 2){
                  starr = "⭐";
                  console.log(starr);
                  stars.innerHTML = "Star Rating: " + starr;
               }
               else{
                  starr = "⭐⭐";
                  console.log(starr);
                  stars.innerHTML = "Star Rating: " + starr;
               }
               nums.push(id);
               console.log(nums);
               clicks++;
            }
            if(clicks == 2){
               console.log("checking...");
               console.log("in clicks");
               done = true;
               setTimeout(function(){
                  for(i of document.querySelector("#card_holder").childNodes){
                     if(i.style.backgroundColor != "green" && i.nodeName != "BR" && i.nodeName != "#text"){
                        console.log(i);
                        done = false;
                        break;
                     }

                  }
                  console.log(done);
                  // if the board is solved
                  if(done){
                     Jalert("You Won! <br> <br> Star Rating: " + starr + "<br> <br> Moves: " + counter , "<div style='color:orange;'>You Won!</div>",4000);
                     decode("reset");
                     document.querySelector("." + level).click();
                     if(level == "custom"){
                        decode("create")
                     }
                  }
               },1500)
               setTimeout(check,500);
            }
         }
      }
      function check(){
         if(memory_dictionary[parseInt(document.getElementById(nums[0]).dataset.number)] == memory_dictionary[parseInt(document.getElementById(nums[1]).dataset.number)]){
            console.log("right " + nums + " " + memory_dictionary);
            document.getElementById(nums[0]).style.backgroundColor = "green";
            document.getElementById(nums[1]).style.backgroundColor = "green";
            clicks = 0;
            nums = [];
         }
         else{
            flip_back(nums[0]);
            flip_back(nums[1]);
            clicks = 0;
            nums = [];
         }
      }

      function decode(func,event){ // function to decode what the user enters
         console.log(mode);
         console.log("in make_grid_call");
         event = event || false;
         counter = 0;
         starr = "";
         moves.innerHTML = "Moves: " + counter;
         stars.innerHTML = "Star Rating: " + starr;
         //check if the  function is reset
         if(func == "reset"){
            console.log("reseting.....");
            reset_grid();
            return;
         }
         let grid_size = document.getElementById("value").value;
         let parts = grid_size.split('x');
         let sizes = parts.map(x => Number(x.trim()));
         if (event != false) {
            console.log((event.which == 13) ? true : false);
            if(event.which == 13){
               if(mode == "img"){
                  if(!parts || parts.length != 2 && parseInt(sizes[0]) * parseInt(sizes[1])  > 2 * pics.length || !parts || parts.length != 2 || parseInt(sizes[0]) * parseInt(sizes[1])  > 2 * pics.length) {
                     console.error("InputError: Invalid  size");
                     Jalert("<p style='color:red'>InputError: Invalid  size</p>","Error",4000);
                     return;
                  }
               }
               else{
                  if(!parts || parts.length != 2) {
                     console.error("InputError: Invalid  size");
                     console.log("error");
                     Jalert("<p style='color:red'>InputError: Invalid  size</p>","Error",4000);
                     console.log("alerting...")
                     return;
                  }
               }
               if(func == "create"){
                  reset_grid()
                  make_grid(sizes[0], sizes[1]);
               }
            }
            return;
         }
         else{
            if(mode == "img"){
               console.log("mode is img")
               if(!parts || parts.length != 2 && parseInt(sizes[0]) * parseInt(sizes[1])  > 2 * pics.length || !parts || parts.length != 2 || parseInt(sizes[0]) * parseInt(sizes[1])  > 2 * pics.length) {
                  console.error("InputError: Invalid  size");
                  console.log("error");
                  Jalert("<p style='color:red'>InputError: Invalid  size</p>","Error",4000);
                  console.log("alerting...")
                  return;
               }
            }
            else{
               if(!parts || parts.length != 2) {
                  console.error("InputError: Invalid  size");
                  console.log("error");
                  Jalert("<p style='color:red'>InputError: Invalid  size</p>","Error",4000);
                  console.log("alerting...")
                  return;
               }
            }
         }
         if(func == "create"){
            reset_grid()
            make_grid(sizes[0], sizes[1]);
         }
      }
      function shuffle(list){
         let shuffled_list = [];
         let i = 0;
         while(i < list.length){
            let index = Math.floor(Math.random() * list.length);
            shuffled_list.push(list[index]);
            list.splice(index,1);
         }
         return shuffled_list;
      }
      function reset_grid(){
         clicks = 0;
         nums = [];
         document.getElementById("card_holder").remove();
         let new_card_placer = document.createElement("DIV");
         new_card_placer.id = "card_holder";
         new_card_placer.addEventListener("click",choose);
         document.body.appendChild(new_card_placer);
      }
   })();
   </script>
</body>
</html>
